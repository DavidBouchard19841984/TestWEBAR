<!DOCTYPE html>
<html>
<head>
  <title>WebAR Moderne - Mode Débogage</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <script src="//cdn.jsdelivr.net/npm/eruda"></script>
  <script>eruda.init();</script>
</head>

<body>
  <a-scene webxr="requiredFeatures: hit-test;">
    
    <a-xr-button
      id="my-ar-button"
      mode="AR"
      style="position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); padding: 12px 20px; font-size: 18px; border-radius: 5px; border: none; background: #2196F3; color: white; z-index: 1000;">
    </a-xr-button>

    <a-entity
      id="reticle"
      ar-hit-test="target: #floor;"
      scale="0.2 0.2 0.2"
      visible="false"
    >
      <a-ring rotation="-90 0 0"></a-ring>
    </a-entity>
    
    <a-plane id="floor" position="0 0 0" rotation="-90 0 0" width="10" height="10" visible="false"></a-plane>
  </a-scene>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const sceneEl = document.querySelector('a-scene');
      const reticle = document.querySelector('#reticle');
      let objectsPlaced = false;

      // ▼▼▼ CAPTURE D'ERREUR AJOUTÉE ▼▼▼
      // On écoute l'événement 'xr-button-init-error' qui est émis
      // par a-xr-button si quelque chose se passe mal au démarrage.
      const arButton = document.querySelector('#my-ar-button');
      arButton.addEventListener('xr-button-init-error', (err) => {
        console.error("Erreur d'initialisation de WebXR détectée :", err);
        alert("Erreur d'initialisation de WebXR. Vérifiez la console pour les détails.");
      });

      console.log("Page chargée et script initialisé. En attente du clic sur 'Enter AR'.");
      
      reticle.addEventListener('ar-hit-test-start', () => {
        if (!objectsPlaced) {
          reticle.object3D.visible = true;
        }
      });

      reticle.addEventListener('ar-hit-test-stop', () => {
        reticle.object3D.visible = false;
      });

      sceneEl.addEventListener('click', () => {
        if (reticle.object3D.visible && !objectsPlaced) {
          const position = reticle.getAttribute('position');

          const btnHello = document.createElement('a-box');
          btnHello.setAttribute('position', `${position.x - 0.5} ${position.y} ${position.z}`);
          btnHello.setAttribute('color', '#2196F3');
          btnHello.setAttribute('scale', '0.3 0.3 0.3');
          sceneEl.appendChild(btnHello);

          const btnBye = document.createElement('a-box');
          btnBye.setAttribute('position', `${position.x + 0.5} ${position.y} ${position.z}`);
          btnBye.setAttribute('color', '#f44336');
          btnBye.setAttribute('scale', '0.3 0.3 0.3');
          sceneEl.appendChild(btnBye);

          objectsPlaced = true;
          reticle.object3D.visible = false;
        }
      });
    });
  </script>
</body>
</html>